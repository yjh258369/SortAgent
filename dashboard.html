<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sort Agent - Intelligent Document Organization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* Control Buttons */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .btn:active {
            transform: scale(0.98);
        }

        /* Filter Section */
        .filter-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .filter-select, .filter-input {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-size: 0.9rem;
            outline: none;
        }

        .filter-select:focus, .filter-input:focus {
            border-color: var(--primary);
        }

        /* Search Box */
        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-size: 0.9rem;
        }

        .search-box::before {
            content: 'ğŸ”';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .action-info {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Chart Container Fix */
        .chart-container {
            position: relative;
            height: 250px;
        }

        /* Task Launcher Panel */
        .launcher-panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .launcher-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .launcher-title {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .launcher-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 800px) {
            .launcher-grid {
                grid-template-columns: 1fr;
            }
        }

        .launcher-section {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
        }

        .launcher-section h4 {
            font-size: 0.95rem;
            margin-bottom: 15px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .path-input-group {
            display: flex;
            gap: 10px;
        }

        .path-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text);
            font-size: 0.9rem;
        }

        .path-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Step Selector */
        .step-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .step-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: var(--bg-card);
            border-radius: 10px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .step-item:hover {
            border-color: var(--primary);
        }

        .step-item.selected {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .step-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .step-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--border);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .step-item.selected .step-checkbox {
            background: var(--primary);
            border-color: var(--primary);
        }

        .step-checkbox::after {
            content: 'âœ“';
            color: white;
            font-size: 12px;
            opacity: 0;
        }

        .step-item.selected .step-checkbox::after {
            opacity: 1;
        }

        .step-info {
            flex: 1;
        }

        .step-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .step-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Rule Selector */
        .rule-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rule-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--bg-card);
            border-radius: 10px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .rule-item:hover {
            border-color: var(--primary);
        }

        .rule-item.selected {
            border-color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .rule-radio {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid var(--border);
            margin-right: 12px;
            position: relative;
        }

        .rule-item.selected .rule-radio {
            border-color: var(--secondary);
        }

        .rule-item.selected .rule-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--secondary);
        }

        .rule-info {
            flex: 1;
        }

        .rule-name {
            font-weight: 500;
        }

        .rule-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Execute Section */
        .execute-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
        }

        .execute-info {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .execute-info strong {
            color: var(--primary);
        }

        .btn-browse {
            padding: 6px 12px;
            border: 1px solid var(--primary);
            border-radius: 6px;
            background: var(--card);
            color: var(--primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-browse:hover {
            background: var(--primary);
            color: white;
        }

        .execute-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-execute {
            padding: 14px 30px;
            font-size: 1rem;
        }

        /* Folder Preview Dialog */
        .folder-preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.2s ease;
        }

        .folder-preview-dialog {
            background: var(--card);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .folder-preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
        }

        .folder-preview-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--text);
        }

        .folder-preview-header .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            padding: 5px;
            line-height: 1;
        }

        .folder-preview-header .close-btn:hover {
            color: var(--text);
        }

        .folder-preview-stats {
            padding: 15px 20px;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .stat-item {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .type-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-left: auto;
        }

        .type-badge {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        .folder-preview-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            max-height: 350px;
        }

        .preview-section {
            margin-bottom: 20px;
        }

        .preview-section h4 {
            margin: 0 0 10px 0;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .file-list-preview, .folder-list-preview {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .file-item-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: var(--bg);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .file-icon {
            font-size: 1.1rem;
        }

        .file-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-size {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .folder-item-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: var(--bg);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .folder-icon {
            font-size: 1.1rem;
        }

        .folder-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .more-files {
            text-align: center;
            color: var(--text-muted);
            padding: 10px;
            font-size: 0.85rem;
        }

        .empty-folder {
            text-align: center;
            color: var(--text-muted);
            padding: 40px;
            font-size: 1rem;
        }

        .folder-preview-actions {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            align-items: center;
            background: var(--bg);
        }

        .path-confirm-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: monospace;
            background: var(--card);
            color: var(--text);
        }

        .path-confirm-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Progress Section */
        .progress-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
        }

        .progress-section.active {
            display: block;
        }

        .progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .progress-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar-container {
            height: 8px;
            background: var(--bg-card);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            background: var(--bg-card);
        }

        .progress-step.running {
            background: rgba(99, 102, 241, 0.2);
        }

        .progress-step.completed {
            background: rgba(16, 185, 129, 0.2);
        }

        .progress-step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .progress-step.pending .progress-step-icon {
            background: var(--border);
        }

        .progress-step.running .progress-step-icon {
            background: var(--primary);
            animation: pulse 1s infinite;
        }

        .progress-step.completed .progress-step-icon {
            background: var(--secondary);
        }

        .progress-step-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .progress-step-status {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Execution Dialog */
        .execution-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .execution-dialog-content {
            background: var(--bg-card);
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .dialog-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
        }

        .dialog-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .dialog-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.8rem;
            cursor: pointer;
            line-height: 1;
        }

        .dialog-close:hover {
            color: var(--text);
        }

        .dialog-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .dialog-section {
            margin-bottom: 25px;
        }

        .dialog-section:last-child {
            margin-bottom: 0;
        }

        .dialog-section h4 {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prompt-textarea {
            width: 100%;
            height: 180px;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            resize: vertical;
        }

        .prompt-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .launch-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .launch-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: var(--bg);
            border-radius: 12px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .launch-option:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(5px);
        }

        .launch-option-icon {
            font-size: 2rem;
        }

        .launch-option-text {
            flex: 1;
        }

        .launch-option-text strong {
            display: block;
            margin-bottom: 4px;
        }

        .launch-option-text span {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .manual-steps {
            padding-left: 20px;
            margin: 0;
        }

        .manual-steps li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .manual-steps code {
            background: var(--bg);
            padding: 4px 10px;
            border-radius: 6px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            color: var(--secondary);
        }

        .dialog-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            background: var(--bg);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            border: 1px solid var(--border);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title span {
            font-size: 1.5rem;
        }

        /* File List */
        .file-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            background: var(--bg);
            transition: background 0.3s;
            cursor: pointer;
        }

        .file-item:hover {
            background: var(--bg-hover);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .file-icon.template { background: rgba(99, 102, 241, 0.2); }
        .file-icon.guide { background: rgba(16, 185, 129, 0.2); }
        .file-icon.log { background: rgba(245, 158, 11, 0.2); }
        .file-icon.index { background: rgba(236, 72, 153, 0.2); }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .file-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .file-stars {
            color: var(--warning);
            font-size: 0.9rem;
        }

        /* Task Flow */
        .task-flow {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--bg);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .task-item:hover {
            transform: translateX(10px);
            background: var(--bg-hover);
        }

        .task-item.completed {
            border-left-color: var(--secondary);
        }

        .task-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .task-item.completed .task-number {
            background: var(--secondary);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
        }

        .task-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .task-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .task-status.done {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
        }

        /* Directory Tree */
        .tree-container {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
        }

        .tree-item {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .tree-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 1px;
            background: var(--border);
        }

        .tree-item::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 15px;
            height: 1px;
            background: var(--border);
        }

        .tree-folder {
            color: var(--warning);
        }

        .tree-file {
            color: var(--text);
        }

        .tree-stars {
            margin-left: 10px;
            color: var(--warning);
        }

        /* Tags */
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tag {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            background: var(--bg);
            border: 1px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
        }

        .tag:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .tag.count {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
        }

        /* Importance Bars */
        .importance-bars {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .importance-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .importance-label {
            width: 120px;
            font-size: 0.9rem;
        }

        .importance-bar {
            flex: 1;
            height: 24px;
            background: var(--bg);
            border-radius: 12px;
            overflow: hidden;
        }

        .importance-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 1s ease-out;
        }

        .importance-fill.star-5 { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .importance-fill.star-4 { background: linear-gradient(90deg, #6366f1, #818cf8); }
        .importance-fill.star-3 { background: linear-gradient(90deg, #10b981, #34d399); }

        .importance-count {
            width: 30px;
            text-align: right;
            font-weight: 600;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--text);
        }

        .modal h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-right: 30px;
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section h4 {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .modal-tag {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            background: var(--bg);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>Sort Agent</h1>
            <p>Intelligent Document Organization for Claude Code</p>
        </header>

        <!-- Control Buttons -->
        <div class="controls animate-in">
            <button class="btn btn-primary" onclick="openLauncher()">
                <span>ğŸš€</span> å¯åŠ¨ä»»åŠ¡
            </button>
            <button class="btn btn-secondary" onclick="refreshData()">
                <span>ğŸ”„</span> åˆ·æ–°æ•°æ®
            </button>
            <button class="btn btn-secondary" onclick="exportData()">
                <span>ğŸ“¤</span> å¯¼å‡ºæŠ¥å‘Š
            </button>
            <button class="btn btn-secondary" onclick="toggleView()">
                <span>ğŸ‘ï¸</span> åˆ‡æ¢è§†å›¾
            </button>
            <button class="btn btn-warning" onclick="showStats()">
                <span>ğŸ“Š</span> ç»Ÿè®¡åˆ†æ
            </button>
        </div>

        <!-- Task Launcher Panel -->
        <div class="launcher-panel animate-in delay-1" id="launcherPanel">
            <div class="launcher-header">
                <div class="launcher-title">
                    <span>ğŸš€</span> ä»»åŠ¡å¯åŠ¨å™¨
                </div>
                <button class="btn btn-secondary" onclick="browseFolder()">
                    <span>ğŸ“</span> é€‰æ‹©ç›®å½•
                </button>
            </div>

            <div class="launcher-grid">
                <!-- Rules Section -->
                <div class="launcher-section">
                    <h4><span>ğŸ“‹</span> é€‰æ‹©è§„åˆ™æ¨¡æ¿</h4>
                    <div class="rule-list">
                        <div class="rule-item selected" onclick="selectRule(this, 'full')">
                            <div class="rule-radio"></div>
                            <div class="rule-info">
                                <div class="rule-name">å®Œæ•´æ•´ç†æµç¨‹</div>
                                <div class="rule-desc">æ‰«æâ†’æ‘˜è¦â†’æ ‡ç­¾â†’å»é‡â†’READMEâ†’ä¼˜åŒ–</div>
                            </div>
                        </div>
                        <div class="rule-item" onclick="selectRule(this, 'quick')">
                            <div class="rule-radio"></div>
                            <div class="rule-info">
                                <div class="rule-name">å¿«é€Ÿæ•´ç†</div>
                                <div class="rule-desc">ä»…æ‰«æâ†’æ‘˜è¦â†’README</div>
                            </div>
                        </div>
                        <div class="rule-item" onclick="selectRule(this, 'analyze')">
                            <div class="rule-radio"></div>
                            <div class="rule-info">
                                <div class="rule-name">ä»…åˆ†æ</div>
                                <div class="rule-desc">æ‰«æâ†’æ‘˜è¦â†’æ ‡ç­¾ï¼ˆä¸ä¿®æ”¹æ–‡ä»¶ï¼‰</div>
                            </div>
                        </div>
                        <div class="rule-item" onclick="selectRule(this, 'custom')">
                            <div class="rule-radio"></div>
                            <div class="rule-info">
                                <div class="rule-name">è‡ªå®šä¹‰æ­¥éª¤</div>
                                <div class="rule-desc">æ‰‹åŠ¨é€‰æ‹©è¦æ‰§è¡Œçš„æ­¥éª¤</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Steps Section -->
                <div class="launcher-section">
                    <h4><span>ğŸ“</span> æ‰§è¡Œæ­¥éª¤ <span id="stepHint" style="font-weight: normal; opacity: 0.7;">(å½“å‰è§„åˆ™: å®Œæ•´æ•´ç†æµç¨‹)</span></h4>
                    <div class="step-selector" id="stepSelector">
                        <div class="step-item selected" data-step="1">
                            <div class="step-checkbox"></div>
                            <div class="step-info">
                                <div class="step-name">1. æ‰«ææ–‡ä»¶</div>
                                <div class="step-desc">è·å–ç›®å½•ä¸‹æ‰€æœ‰ .md æ–‡ä»¶åˆ—è¡¨</div>
                            </div>
                        </div>
                        <div class="step-item selected" data-step="2">
                            <div class="step-checkbox"></div>
                            <div class="step-info">
                                <div class="step-name">2. è¯»å–å†…å®¹</div>
                                <div class="step-desc">æå–æ¯ä¸ªæ–‡ä»¶çš„æ–‡æœ¬å†…å®¹</div>
                            </div>
                        </div>
                        <div class="step-item selected" data-step="3">
                            <div class="step-checkbox"></div>
                            <div class="step-info">
                                <div class="step-name">3. ç”Ÿæˆæ‘˜è¦</div>
                                <div class="step-desc">ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆ 200 å­—æ‘˜è¦</div>
                            </div>
                        </div>
                        <div class="step-item selected" data-step="4">
                            <div class="step-checkbox"></div>
                            <div class="step-info">
                                <div class="step-name">4. æ‰“æ ‡ç­¾</div>
                                <div class="step-desc">æ·»åŠ æ—¶é—´/ç±»å‹/é‡è¦æ€§æ ‡ç­¾</div>
                            </div>
                        </div>
                        <div class="step-item selected" data-step="5">
                            <div class="step-checkbox"></div>
                            <div class="step-info">
                                <div class="step-name">5. ç›¸ä¼¼åº¦åˆ†æ</div>
                                <div class="step-desc">è¯†åˆ«é‡å¤å†…å®¹å’Œç›¸ä¼¼æ–‡ä»¶</div>
                            </div>
                        </div>
                        <div class="step-item selected" data-step="6">
                            <div class="step-checkbox"></div>
                            <div class="step-info">
                                <div class="step-name">6. ç”Ÿæˆ README</div>
                                <div class="step-desc">åˆ›å»ºç»“æ„åŒ–ç´¢å¼•æ–‡æ¡£</div>
                            </div>
                        </div>
                        <div class="step-item selected" data-step="7">
                            <div class="step-checkbox"></div>
                            <div class="step-info">
                                <div class="step-name">7. ä¼˜åŒ–ç»“æ„</div>
                                <div class="step-desc">é‡å‘½å/åˆå¹¶/åˆ é™¤æ–‡ä»¶</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Execute Section -->
            <div class="execute-section">
                <div class="execute-info">
                    å·²é€‰æ‹© <strong id="selectedCount">7</strong> ä¸ªæ­¥éª¤ |
                    ç›®æ ‡ç›®å½•:
                    <input type="text" id="targetPath" class="path-input" value="e:\07-æ–‡ä»¶å¤¹ç®¡ç†\memory" placeholder="é€‰æ‹©æˆ–è¾“å…¥ç›®å½•è·¯å¾„">
                </div>
                <div class="execute-buttons">
                    <button class="btn btn-secondary" onclick="selectAllSteps()">å…¨é€‰</button>
                    <button class="btn btn-secondary" onclick="deselectAllSteps()">æ¸…ç©º</button>
                    <button class="btn btn-success btn-execute" onclick="executeTask()">
                        <span>â–¶</span> å¼€å§‹æ‰§è¡Œ
                    </button>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section" id="progressSection">
                <div class="progress-header">
                    <div class="progress-title">
                        <span>â³</span> æ‰§è¡Œè¿›åº¦
                    </div>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="progress-steps" id="progressSteps">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="quick-actions" id="quickActions" style="display: none;">
                    <button class="quick-btn" onclick="viewResults()">ğŸ“‹ æŸ¥çœ‹ç»“æœ</button>
                    <button class="quick-btn" onclick="exportLog()">ğŸ“„ å¯¼å‡ºæ—¥å¿—</button>
                    <button class="quick-btn" onclick="runAgain()">ğŸ”„ å†æ¬¡æ‰§è¡Œ</button>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section animate-in delay-1">
            <div class="filter-row">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="æœç´¢æ–‡ä»¶åã€æ ‡ç­¾æˆ–å…³é”®è¯..." oninput="filterFiles()">
                </div>
                <div class="filter-group">
                    <span class="filter-label">ç±»å‹:</span>
                    <select class="filter-select" id="typeFilter" onchange="filterFiles()">
                        <option value="all">å…¨éƒ¨ç±»å‹</option>
                        <option value="template">æ¨¡æ¿æ–‡æ¡£</option>
                        <option value="guide">ä½¿ç”¨æŒ‡å—</option>
                        <option value="index">ç´¢å¼•æ–‡æ¡£</option>
                        <option value="log">æ‰§è¡Œæ—¥å¿—</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span class="filter-label">é‡è¦æ€§:</span>
                    <select class="filter-select" id="importanceFilter" onchange="filterFiles()">
                        <option value="all">å…¨éƒ¨</option>
                        <option value="5">â­â­â­â­â­ å…³é”®</option>
                        <option value="4">â­â­â­â­ é‡è¦</option>
                        <option value="3">â­â­â­ å‚è€ƒ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span class="filter-label">æ’åº:</span>
                    <select class="filter-select" id="sortFilter" onchange="sortFiles()">
                        <option value="importance">æŒ‰é‡è¦æ€§</option>
                        <option value="name">æŒ‰åç§°</option>
                        <option value="lines">æŒ‰è¡Œæ•°</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card animate-in">
                <div class="stat-icon">ğŸ“„</div>
                <div class="stat-value">7</div>
                <div class="stat-label">æ€»æ–‡ä»¶æ•°</div>
            </div>
            <div class="stat-card animate-in delay-1">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-value">1,731</div>
                <div class="stat-label">æ€»è¡Œæ•°</div>
            </div>
            <div class="stat-card animate-in delay-2">
                <div class="stat-icon">â­</div>
                <div class="stat-value">4.0</div>
                <div class="stat-label">å¹³å‡é‡è¦æ€§</div>
            </div>
            <div class="stat-card animate-in delay-3">
                <div class="stat-icon">ğŸ”„</div>
                <div class="stat-value">3</div>
                <div class="stat-label">é‡å¤ç»„å·²å¤„ç†</div>
            </div>
            <div class="stat-card animate-in delay-4">
                <div class="stat-icon">âœ…</div>
                <div class="stat-value">100%</div>
                <div class="stat-label">ä»»åŠ¡å®Œæˆç‡</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- File Type Distribution -->
            <div class="card animate-in">
                <div class="card-header">
                    <div class="card-title"><span>ğŸ“Š</span> æ–‡ä»¶ç±»å‹åˆ†å¸ƒ</div>
                </div>
                <div class="chart-container">
                    <canvas id="typeChart"></canvas>
                </div>
            </div>

            <!-- Importance Distribution -->
            <div class="card animate-in delay-1">
                <div class="card-header">
                    <div class="card-title"><span>â­</span> é‡è¦æ€§åˆ†å¸ƒ</div>
                </div>
                <div class="importance-bars">
                    <div class="importance-item">
                        <div class="importance-label">â­â­â­â­â­ å…³é”®</div>
                        <div class="importance-bar">
                            <div class="importance-fill star-5" style="width: 66.6%"></div>
                        </div>
                        <div class="importance-count">2</div>
                    </div>
                    <div class="importance-item">
                        <div class="importance-label">â­â­â­â­ é‡è¦</div>
                        <div class="importance-bar">
                            <div class="importance-fill star-4" style="width: 100%"></div>
                        </div>
                        <div class="importance-count">4</div>
                    </div>
                    <div class="importance-item">
                        <div class="importance-label">â­â­â­ å‚è€ƒ</div>
                        <div class="importance-bar">
                            <div class="importance-fill star-3" style="width: 33.3%"></div>
                        </div>
                        <div class="importance-count">1</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Second Row -->
        <div class="main-grid">
            <!-- File List -->
            <div class="card animate-in">
                <div class="card-header">
                    <div class="card-title"><span>ğŸ“</span> æ–‡ä»¶åˆ—è¡¨</div>
                </div>
                <div class="file-list" id="fileList"></div>
            </div>

            <!-- Task Flow -->
            <div class="card animate-in delay-1">
                <div class="card-header">
                    <div class="card-title"><span>ğŸ”„</span> ä»»åŠ¡æµç¨‹</div>
                </div>
                <div class="task-flow" id="taskFlow"></div>
            </div>
        </div>

        <!-- Third Row -->
        <div class="main-grid">
            <!-- Directory Tree -->
            <div class="card animate-in">
                <div class="card-header">
                    <div class="card-title"><span>ğŸ“‚</span> ç›®å½•ç»“æ„</div>
                </div>
                <div class="tree-container" id="directoryTree"></div>
            </div>

            <!-- Tag Cloud -->
            <div class="card animate-in delay-1">
                <div class="card-header">
                    <div class="card-title"><span>ğŸ·ï¸</span> ä¸»é¢˜æ ‡ç­¾</div>
                </div>
                <div class="tag-cloud" id="tagCloud"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>Sort Agent v1.0 - Intelligent Document Organization | 2026</p>
        </footer>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <h3 id="modalTitle"></h3>
            <div class="modal-section">
                <h4>æ‘˜è¦</h4>
                <p id="modalSummary"></p>
            </div>
            <div class="modal-section">
                <h4>æ ‡ç­¾</h4>
                <div class="modal-tags" id="modalTags"></div>
            </div>
            <div class="modal-section">
                <h4>ç»Ÿè®¡</h4>
                <p id="modalStats"></p>
            </div>
        </div>
    </div>

    <script>
        // Data
        const files = [
            {
                name: 'CLAUDE_CODE_README_TEMPLATE.md',
                type: 'template',
                typeName: 'æ¨¡æ¿æ–‡æ¡£',
                importance: 5,
                lines: 438,
                size: '~14 KB',
                summary: 'é€šç”¨çš„æ–‡æ¡£æ•´ç†ä¸åˆ†æä»»åŠ¡æ¡†æ¶ï¼Œé€‚ç”¨äº Claude Codeã€Cursor ç­‰ AI ç¼–ç¨‹åŠ©æ‰‹ã€‚åŒ…å«å®Œæ•´çš„ 7 é˜¶æ®µä»»åŠ¡æµç¨‹ã€JSON å‚æ•°é…ç½®ã€3 ç§æ‰§è¡Œç­–ç•¥ã€4 ç§ä½¿ç”¨åœºæ™¯ã€é«˜çº§ç”¨æ³•å’Œå¸¸è§é—®é¢˜è§£ç­”ã€‚',
                topics: ['ä»»åŠ¡æ¨¡æ¿', 'æ–‡æ¡£æ•´ç†', 'è‡ªåŠ¨åŒ–', 'AIç¼–ç¨‹åŠ©æ‰‹'],
                keywords: ['7é˜¶æ®µ', 'å‚æ•°é…ç½®', 'æ‰§è¡Œç­–ç•¥', 'Gité›†æˆ']
            },
            {
                name: 'CLAUDE_CODE_TASK_PROMPT.md',
                type: 'template',
                typeName: 'ä»»åŠ¡ç¼–æ’',
                importance: 5,
                lines: 526,
                size: '~16 KB',
                summary: 'é’ˆå¯¹æ–‡æ¡£ç›®å½•çš„è¯¦ç»†ä»»åŠ¡ç¼–æ’æ–‡æ¡£ã€‚åŒ…å« 7 ä¸ªç‹¬ç«‹ä»»åŠ¡çš„å®Œæ•´æç¤ºè¯ã€ä¾èµ–å…³ç³»ã€è¶…æ—¶è®¾ç½®å’Œé¢„æœŸè¾“å‡ºã€‚æä¾›äº†ä»»åŠ¡æµç¨‹å›¾ã€æ‰§è¡Œç­–ç•¥å’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚',
                topics: ['æç¤ºè¯å·¥ç¨‹', 'OpenClaw', 'ä»»åŠ¡ç¼–æ’', 'æ–‡æ¡£æ•´ç†'],
                keywords: ['7ä»»åŠ¡', 'ä¾èµ–å…³ç³»', 'æµç¨‹å›¾', 'é”™è¯¯å¤„ç†']
            },
            {
                name: 'ONE_PAGE_TEMPLATE.md',
                type: 'template',
                typeName: 'é€ŸæŸ¥è¡¨',
                importance: 4,
                lines: 89,
                size: '~2.4 KB',
                summary: 'å•é¡µé€ŸæŸ¥è¡¨ï¼Œé€‚åˆæ‰“å°æˆ–å¿«é€ŸæŸ¥çœ‹ã€‚åŒ…å«æ ¸å¿ƒä»»åŠ¡æç¤ºè¯ã€æ ‡ç­¾ç³»ç»Ÿé€ŸæŸ¥è¡¨ã€è¾“å‡ºæ–‡ä»¶è¯´æ˜ã€JSON å‚æ•°é…ç½®å’Œä½¿ç”¨åœºæ™¯å¯¹æ¯”ã€‚',
                topics: ['å¿«é€Ÿå‚è€ƒ', 'é€ŸæŸ¥è¡¨', 'ä»»åŠ¡æ¨¡æ¿'],
                keywords: ['å•é¡µ', 'æ ¸å¿ƒæç¤ºè¯', 'å‚æ•°è¡¨', 'åœºæ™¯å¯¹æ¯”']
            },
            {
                name: 'QUICK_USE.md',
                type: 'guide',
                typeName: 'ä½¿ç”¨æŒ‡å—',
                importance: 4,
                lines: 214,
                size: '~6 KB',
                summary: 'å¿«é€Ÿä½¿ç”¨æŒ‡å—ï¼Œé€‚åˆæ–°æ‰‹ç”¨æˆ·ã€‚åŒ…å«ä¸€é”®æ‰§è¡Œæç¤ºè¯ã€5 æ­¥åˆ†æ­¥æ‰§è¡Œã€è‡ªå®šä¹‰å‚æ•°è¡¨ã€é¢„æœŸè¾“å‡ºå±•ç¤ºã€4 ç§å¸¸è§åœºæ™¯ã€éªŒè¯æ¸…å•å’Œå¿«é€Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆã€‚',
                topics: ['å¿«é€Ÿä½¿ç”¨', 'åœºæ™¯ç¤ºä¾‹', 'æ–°æ‰‹æŒ‡å—'],
                keywords: ['ä¸€é”®æ‰§è¡Œ', 'è‡ªå®šä¹‰å‚æ•°', 'åœºæ™¯ç¤ºä¾‹', 'éªŒè¯æ¸…å•']
            },
            {
                name: 'TEMPLATES_INDEX.md',
                type: 'guide',
                typeName: 'æ¨¡æ¿ç´¢å¼•',
                importance: 4,
                lines: 204,
                size: '~5 KB',
                summary: 'æ¨¡æ¿åº“ç´¢å¼•æ–‡æ¡£ï¼Œä»‹ç» 4 ä¸ªä¸»è¦æ¨¡æ¿çš„åŠŸèƒ½å’Œé€‰æ‹©æŒ‡å—ã€‚æä¾›åŠŸèƒ½å¯¹æ¯”è¡¨ã€è‡ªå®šä¹‰å»ºè®®å’Œæœ€ä½³å®è·µã€‚',
                topics: ['æ¨¡æ¿ç´¢å¼•', 'å¿«é€Ÿé€‰æ‹©', 'åŠŸèƒ½å¯¹æ¯”'],
                keywords: ['4æ¨¡æ¿', 'åŠŸèƒ½å¯¹æ¯”', 'é€‰æ‹©æŒ‡å—', 'è‡ªå®šä¹‰å»ºè®®']
            },
            {
                name: 'README.md',
                type: 'index',
                typeName: 'ç´¢å¼•æ–‡æ¡£',
                importance: 4,
                lines: 158,
                size: '~4 KB',
                summary: 'Memory ç›®å½•çš„ç´¢å¼•æ–‡æ¡£ï¼Œè®°å½• Claude Code ä»»åŠ¡ç¼–æ’æ¨¡æ¿å’Œæ–‡æ¡£æ•´ç†å·¥å…·é›†ã€‚æä¾›æŒ‰é‡è¦æ€§åˆ†ç»„ã€æ ‡ç­¾ç´¢å¼•ã€å¿«é€ŸæŸ¥æ‰¾æŒ‡å—å’Œæ¨èä½¿ç”¨æµç¨‹ã€‚',
                topics: ['æ–‡æ¡£ç´¢å¼•', 'å¯¼èˆª', 'å¿«é€ŸæŸ¥æ‰¾'],
                keywords: ['ç´¢å¼•', 'å¯¼èˆª', 'é‡è¦æ€§åˆ†ç»„', 'æ ‡ç­¾ç´¢å¼•']
            },
            {
                name: 'FILE_ANALYSIS.md',
                type: 'index',
                typeName: 'åˆ†ææŠ¥å‘Š',
                importance: 4,
                lines: 278,
                size: '~7 KB',
                summary: 'æ–‡ä»¶åˆ†ææŠ¥å‘Šï¼ŒåŒ…å«ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„è¯¦ç»†æ‘˜è¦ã€JSON æ ‡ç­¾æ•°æ®ã€é‡å¤å†…å®¹åˆ†æå’Œä¼˜åŒ–å»ºè®®ã€‚',
                topics: ['æ–‡ä»¶åˆ†æ', 'æ ‡ç­¾ç³»ç»Ÿ'],
                keywords: ['æ‘˜è¦', 'æ ‡ç­¾', 'é‡å¤åˆ†æ']
            },
            {
                name: 'EXECUTION_LOG.md',
                type: 'log',
                typeName: 'æ‰§è¡Œæ—¥å¿—',
                importance: 3,
                lines: 219,
                size: '~5 KB',
                summary: '2026-02-27 æ‰§è¡Œçš„æ–‡æ¡£æ•´ç†ä»»åŠ¡è®°å½•ã€‚å¤„ç†äº† 8 ä¸ª .md æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ‰«æã€å†…å®¹è¯»å–ã€æ‘˜è¦ç”Ÿæˆã€æ ‡ç­¾ç³»ç»Ÿã€é‡å¤å†…å®¹è¯†åˆ«å’Œ README ç”Ÿæˆã€‚',
                topics: ['æ‰§è¡Œè®°å½•', 'OpenClaw', 'æ–‡æ¡£æ•´ç†'],
                keywords: ['ä»»åŠ¡å®Œæˆ', 'é‡å¤è¯†åˆ«', 'æ–‡ä»¶ä¼˜åŒ–', 'å¤‡ä»½']
            }
        ];

        const tasks = [
            { num: 1, title: 'æ‰«ææ–‡ä»¶', desc: 'è·å–ç›®å½•ä¸‹æ‰€æœ‰ .md æ–‡ä»¶åˆ—è¡¨', status: 'done' },
            { num: 2, title: 'è¯»å–å†…å®¹', desc: 'æå–æ¯ä¸ªæ–‡ä»¶çš„æ–‡æœ¬å†…å®¹', status: 'done' },
            { num: 3, title: 'ç”Ÿæˆæ‘˜è¦', desc: 'ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆ 200 å­—æ‘˜è¦', status: 'done' },
            { num: 4, title: 'æ‰“æ ‡ç­¾', desc: 'æ·»åŠ æ—¶é—´/ç±»å‹/é‡è¦æ€§æ ‡ç­¾', status: 'done' },
            { num: 5, title: 'ç›¸ä¼¼åº¦åˆ†æ', desc: 'è¯†åˆ«é‡å¤å†…å®¹å’Œç›¸ä¼¼æ–‡ä»¶', status: 'done' },
            { num: 6, title: 'ç”Ÿæˆ README', desc: 'åˆ›å»ºç»“æ„åŒ–ç´¢å¼•æ–‡æ¡£', status: 'done' },
            { num: 7, title: 'ä¼˜åŒ–ç»“æ„', desc: 'é‡å‘½å/åˆå¹¶/åˆ é™¤æ–‡ä»¶', status: 'done' }
        ];

        const tags = [
            { name: 'ä»»åŠ¡æ¨¡æ¿', count: 3 },
            { name: 'æ–‡æ¡£æ•´ç†', count: 4 },
            { name: 'æç¤ºè¯å·¥ç¨‹', count: 1 },
            { name: 'å¿«é€Ÿå‚è€ƒ', count: 2 },
            { name: 'OpenClaw', count: 2 },
            { name: 'è‡ªåŠ¨åŒ–', count: 2 },
            { name: 'AIç¼–ç¨‹åŠ©æ‰‹', count: 1 },
            { name: 'æ–°æ‰‹æŒ‡å—', count: 1 },
            { name: 'æ‰§è¡Œè®°å½•', count: 1 },
            { name: 'æ–‡æ¡£ç´¢å¼•', count: 1 },
            { name: 'æ ‡ç­¾ç³»ç»Ÿ', count: 2 },
            { name: 'åŠŸèƒ½å¯¹æ¯”', count: 1 }
        ];

        // Render File List
        function renderFileList() {
            const container = document.getElementById('fileList');
            container.innerHTML = files.map(file => `
                <div class="file-item" onclick="showFileDetail('${file.name}')">
                    <div class="file-icon ${file.type}">
                        ${file.type === 'template' ? 'ğŸ“‹' : file.type === 'guide' ? 'ğŸ“–' : file.type === 'log' ? 'ğŸ“' : 'ğŸ—‚ï¸'}
                    </div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">${file.typeName} Â· ${file.lines} è¡Œ Â· ${file.size}</div>
                    </div>
                    <div class="file-stars">${'â­'.repeat(file.importance)}</div>
                </div>
            `).join('');
        }

        // Render Task Flow
        function renderTaskFlow() {
            const container = document.getElementById('taskFlow');
            container.innerHTML = tasks.map(task => `
                <div class="task-item ${task.status === 'done' ? 'completed' : ''}">
                    <div class="task-number">${task.status === 'done' ? 'âœ“' : task.num}</div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-desc">${task.desc}</div>
                    </div>
                    <span class="task-status ${task.status === 'done' ? 'done' : ''}">${task.status === 'done' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}</span>
                </div>
            `).join('');
        }

        // Render Directory Tree
        function renderDirectoryTree() {
            const container = document.getElementById('directoryTree');
            const treeHtml = `
                <div class="tree-item tree-folder">ğŸ“ memory/</div>
                ${files.map(file => `
                    <div class="tree-item" style="padding-left: 40px;">
                        <span class="tree-file">ğŸ“„ ${file.name}</span>
                        <span class="tree-stars">${'â­'.repeat(file.importance)}</span>
                    </div>
                `).join('')}
                <div class="tree-item tree-folder" style="padding-left: 40px;">ğŸ“ archive/</div>
                <div class="tree-item" style="padding-left: 60px;"><span class="tree-file">ğŸ“„ QUICK_USE.md (å¤‡ä»½)</span></div>
                <div class="tree-item" style="padding-left: 60px;"><span class="tree-file">ğŸ“„ QUICK_START_GUIDE.md (å·²åˆå¹¶)</span></div>
            `;
            container.innerHTML = treeHtml;
        }

        // Render Tag Cloud
        function renderTagCloud() {
            const container = document.getElementById('tagCloud');
            container.innerHTML = tags.map(tag => `
                <span class="tag">${tag.name} <span class="tag count">${tag.count}</span></span>
            `).join('');
        }

        // Show File Detail Modal
        function showFileDetail(fileName) {
            const file = files.find(f => f.name === fileName);
            if (!file) return;

            document.getElementById('modalTitle').textContent = file.name;
            document.getElementById('modalSummary').textContent = file.summary;
            document.getElementById('modalTags').innerHTML = [
                ...file.topics.map(t => `<span class="modal-tag">${t}</span>`),
                ...file.keywords.map(k => `<span class="modal-tag">${k}</span>`)
            ].join('');
            document.getElementById('modalStats').innerHTML = `
                <strong>è¡Œæ•°:</strong> ${file.lines} è¡Œ<br>
                <strong>å¤§å°:</strong> ${file.size}<br>
                <strong>é‡è¦æ€§:</strong> ${'â­'.repeat(file.importance)}<br>
                <strong>ç±»å‹:</strong> ${file.typeName}
            `;

            document.getElementById('modalOverlay').classList.add('active');
        }

        // Close Modal
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // Close modal on overlay click
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize Chart
        let typeChart = null;

        function initChart() {
            const ctx = document.getElementById('typeChart');
            if (!ctx) return;

            const typeCounts = {
                'æ¨¡æ¿æ–‡æ¡£': files.filter(f => f.type === 'template').length,
                'ä½¿ç”¨æŒ‡å—': files.filter(f => f.type === 'guide').length,
                'ç´¢å¼•æ–‡æ¡£': files.filter(f => f.type === 'index').length,
                'æ‰§è¡Œæ—¥å¿—': files.filter(f => f.type === 'log').length
            };

            // Destroy existing chart if exists
            if (typeChart) {
                typeChart.destroy();
            }

            typeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(typeCounts),
                    datasets: [{
                        data: Object.values(typeCounts),
                        backgroundColor: [
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderColor: [
                            'rgba(99, 102, 241, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(236, 72, 153, 1)',
                            'rgba(245, 158, 11, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#f1f5f9',
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // Control Functions

        // Task Launcher State
        let selectedRule = 'full';
        let selectedSteps = [1, 2, 3, 4, 5, 6, 7];
        let isExecuting = false;

        // Rule definitions
        const ruleSteps = {
            'full': [1, 2, 3, 4, 5, 6, 7],
            'quick': [1, 2, 3, 6],
            'analyze': [1, 2, 3, 4],
            'custom': [1, 2, 3, 4, 5, 6, 7]
        };

        const ruleNames = {
            'full': 'å®Œæ•´æ•´ç†æµç¨‹',
            'quick': 'å¿«é€Ÿæ•´ç†',
            'analyze': 'ä»…åˆ†æ',
            'custom': 'è‡ªå®šä¹‰æ­¥éª¤'
        };

        // Step definitions
        const stepDefinitions = {
            1: { name: 'æ‰«ææ–‡ä»¶', desc: 'è·å–ç›®å½•ä¸‹æ‰€æœ‰ .md æ–‡ä»¶åˆ—è¡¨', time: 500 },
            2: { name: 'è¯»å–å†…å®¹', desc: 'æå–æ¯ä¸ªæ–‡ä»¶çš„æ–‡æœ¬å†…å®¹', time: 1000 },
            3: { name: 'ç”Ÿæˆæ‘˜è¦', desc: 'ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆ 200 å­—æ‘˜è¦', time: 1500 },
            4: { name: 'æ‰“æ ‡ç­¾', desc: 'æ·»åŠ æ—¶é—´/ç±»å‹/é‡è¦æ€§æ ‡ç­¾', time: 1000 },
            5: { name: 'ç›¸ä¼¼åº¦åˆ†æ', desc: 'è¯†åˆ«é‡å¤å†…å®¹å’Œç›¸ä¼¼æ–‡ä»¶', time: 2000 },
            6: { name: 'ç”Ÿæˆ README', desc: 'åˆ›å»ºç»“æ„åŒ–ç´¢å¼•æ–‡æ¡£', time: 1000 },
            7: { name: 'ä¼˜åŒ–ç»“æ„', desc: 'é‡å‘½å/åˆå¹¶/åˆ é™¤æ–‡ä»¶', time: 1500 }
        };

        function openLauncher() {
            document.getElementById('launcherPanel').scrollIntoView({ behavior: 'smooth' });
        }

        // æµè§ˆæ–‡ä»¶å¤¹
        async function browseFolder() {
            // æ£€æŸ¥æ˜¯å¦æ”¯æŒ File System Access API
            if (!window.showDirectoryPicker) {
                // ä¸æ”¯æŒï¼Œç›´æ¥ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
                fallbackBrowse();
                return;
            }

            try {
                // ä½¿ç”¨ File System Access API é€‰æ‹©æ–‡ä»¶å¤¹
                const dirHandle = await window.showDirectoryPicker();

                // ç›´æ¥è®¾ç½®è·¯å¾„ï¼ˆæµè§ˆå™¨å®‰å…¨é™åˆ¶åªèƒ½è·å–æ–‡ä»¶å¤¹åç§°ï¼‰
                const pathInput = document.getElementById('targetPath');
                pathInput.value = dirHandle.name;
                pathInput.focus();
                pathInput.select();
                showNotification(`å·²é€‰æ‹©æ–‡ä»¶å¤¹: ${dirHandle.name}ï¼ˆå¯æ‰‹åŠ¨ç¼–è¾‘å®Œæ•´è·¯å¾„ï¼‰`, 'success');

            } catch (err) {
                // ç”¨æˆ·å–æ¶ˆ
                if (err.name === 'AbortError') {
                    return;
                }
                // å…¶ä»–é”™è¯¯ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
                console.error('showDirectoryPicker error:', err);
                fallbackBrowse();
            }
        }

        // è·å–æ–‡ä»¶ç±»å‹å›¾æ ‡å’Œé¢œè‰²
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const types = {
                'md': { icon: 'ğŸ“', color: '#083fa8', name: 'Markdown' },
                'txt': { icon: 'ğŸ“„', color: '#666', name: 'æ–‡æœ¬æ–‡ä»¶' },
                'html': { icon: 'ğŸŒ', color: '#e44d26', name: 'HTML' },
                'css': { icon: 'ğŸ¨', color: '#264de4', name: 'CSS' },
                'js': { icon: 'âš¡', color: '#f7df1e', name: 'JavaScript' },
                'json': { icon: 'ğŸ“‹', color: '#5a9f47', name: 'JSON' },
                'py': { icon: 'ğŸ', color: '#3776ab', name: 'Python' },
                'java': { icon: 'â˜•', color: '#007396', name: 'Java' },
                'png': { icon: 'ğŸ–¼ï¸', color: '#8b5cf6', name: 'å›¾ç‰‡' },
                'jpg': { icon: 'ğŸ–¼ï¸', color: '#8b5cf6', name: 'å›¾ç‰‡' },
                'gif': { icon: 'ğŸ–¼ï¸', color: '#8b5cf6', name: 'å›¾ç‰‡' },
                'pdf': { icon: 'ğŸ“•', color: '#dc2626', name: 'PDF' },
                'doc': { icon: 'ğŸ“˜', color: '#2563eb', name: 'Word' },
                'docx': { icon: 'ğŸ“˜', color: '#2563eb', name: 'Word' },
                'xls': { icon: 'ğŸ“—', color: '#16a34a', name: 'Excel' },
                'xlsx': { icon: 'ğŸ“—', color: '#16a34a', name: 'Excel' },
                'zip': { icon: 'ğŸ“¦', color: '#7c3aed', name: 'å‹ç¼©åŒ…' },
                'rar': { icon: 'ğŸ“¦', color: '#7c3aed', name: 'å‹ç¼©åŒ…' }
            };
            return types[ext] || { icon: 'ğŸ“„', color: '#666', name: 'æ–‡ä»¶' };
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // æ˜¾ç¤ºæ–‡ä»¶å¤¹é¢„è§ˆå¯¹è¯æ¡†
        function showFolderPreview(folderName, files, folders) {
            // ç»Ÿè®¡æ–‡ä»¶ç±»å‹
            const typeStats = {};
            files.forEach(f => {
                const type = getFileType(f.name);
                typeStats[type.name] = (typeStats[type.name] || 0) + 1;
            });

            // ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨HTML
            const fileListHtml = files.slice(0, 20).map(f => {
                const type = getFileType(f.name);
                return `
                    <div class="file-item-preview">
                        <span class="file-icon" style="color: ${type.color}">${type.icon}</span>
                        <span class="file-name">${f.name}</span>
                        <span class="file-size">${formatSize(f.size)}</span>
                    </div>
                `;
            }).join('');

            const moreFiles = files.length > 20 ? `<div class="more-files">...è¿˜æœ‰ ${files.length - 20} ä¸ªæ–‡ä»¶</div>` : '';

            // ç”Ÿæˆæ–‡ä»¶å¤¹åˆ—è¡¨
            const folderListHtml = folders.slice(0, 10).map(f => `
                <div class="folder-item-preview">
                    <span class="folder-icon">ğŸ“</span>
                    <span class="folder-name">${f}</span>
                </div>
            `).join('');

            const moreFolders = folders.length > 10 ? `<div class="more-files">...è¿˜æœ‰ ${folders.length - 10} ä¸ªæ–‡ä»¶å¤¹</div>` : '';

            // ç±»å‹ç»Ÿè®¡
            const statsHtml = Object.entries(typeStats).map(([name, count]) =>
                `<span class="type-badge">${name}: ${count}</span>`
            ).join('');

            // åˆ›å»ºå¯¹è¯æ¡†
            const dialog = document.createElement('div');
            dialog.className = 'folder-preview-overlay';
            dialog.innerHTML = `
                <div class="folder-preview-dialog">
                    <div class="folder-preview-header">
                        <h3>ğŸ“ ${folderName}</h3>
                        <button class="close-btn" onclick="this.closest('.folder-preview-overlay').remove()">âœ•</button>
                    </div>
                    <div class="folder-preview-stats">
                        <span class="stat-item">ğŸ“„ ${files.length} ä¸ªæ–‡ä»¶</span>
                        <span class="stat-item">ğŸ“ ${folders.length} ä¸ªæ–‡ä»¶å¤¹</span>
                        <div class="type-stats">${statsHtml}</div>
                    </div>
                    <div class="folder-preview-content">
                        ${folders.length > 0 ? `
                            <div class="preview-section">
                                <h4>ğŸ“ æ–‡ä»¶å¤¹ (${folders.length})</h4>
                                <div class="folder-list-preview">${folderListHtml}${moreFolders}</div>
                            </div>
                        ` : ''}
                        ${files.length > 0 ? `
                            <div class="preview-section">
                                <h4>ğŸ“„ æ–‡ä»¶ (${files.length})</h4>
                                <div class="file-list-preview">${fileListHtml}${moreFiles}</div>
                            </div>
                        ` : ''}
                        ${files.length === 0 && folders.length === 0 ? '<div class="empty-folder">ğŸ“‚ æ­¤æ–‡ä»¶å¤¹ä¸ºç©º</div>' : ''}
                    </div>
                    <div class="folder-preview-actions">
                        <input type="text" id="confirmPath" class="path-confirm-input" value="e:\\${folderName}" placeholder="è¾“å…¥å®Œæ•´è·¯å¾„">
                        <button class="btn btn-primary" onclick="confirmFolderPath()">âœ“ ç¡®è®¤é€‰æ‹©</button>
                        <button class="btn btn-secondary" onclick="this.closest('.folder-preview-overlay').remove()">å–æ¶ˆ</button>
                    </div>
                </div>
            `;

            document.body.appendChild(dialog);
        }

        // ç¡®è®¤é€‰æ‹©çš„æ–‡ä»¶å¤¹è·¯å¾„
        function confirmFolderPath() {
            const path = document.getElementById('confirmPath').value;
            if (path) {
                document.getElementById('targetPath').value = path;
                document.querySelector('.folder-preview-overlay').remove();
                showNotification(`å·²é€‰æ‹©ç›®å½•: ${path}`, 'success');
            }
        }

        // å¤‡ç”¨æµè§ˆæ–¹å¼ï¼ˆä¼ ç»Ÿæµè§ˆå™¨ï¼‰
        function fallbackBrowse() {
            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true;
            input.multiple = true;

            input.onchange = (e) => {
                try {
                    const allFiles = Array.from(e.target.files);
                    if (allFiles.length > 0) {
                        const folderName = allFiles[0].webkitRelativePath.split('/')[0];

                        // ç›´æ¥è®¾ç½®è·¯å¾„
                        const pathInput = document.getElementById('targetPath');
                        pathInput.value = folderName;
                        pathInput.focus();
                        pathInput.select();
                        showNotification(`å·²é€‰æ‹©æ–‡ä»¶å¤¹: ${folderName}ï¼ˆå¯æ‰‹åŠ¨ç¼–è¾‘å®Œæ•´è·¯å¾„ï¼‰`, 'success');
                    } else {
                        showNotification('æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶', 'warning');
                    }
                } catch (err) {
                    console.error('fallbackBrowse error:', err);
                    // å¦‚æœå‡ºé”™ï¼Œç›´æ¥è®©ç”¨æˆ·è¾“å…¥è·¯å¾„
                    const path = prompt('è¯·è¾“å…¥ç›®æ ‡ç›®å½•è·¯å¾„:', 'e:\\07-æ–‡ä»¶å¤¹ç®¡ç†\\memory');
                    if (path) {
                        document.getElementById('targetPath').value = path;
                        showNotification(`å·²è®¾ç½®è·¯å¾„: ${path}`, 'success');
                    }
                }
            };

            input.click();
        }

        // è·å–å½“å‰ç›®å½•
        function getTargetDir() {
            return document.getElementById('targetPath').value;
        }

        // åˆå§‹åŒ–
        function initDirSelect() {
            // å·²æœ‰é»˜è®¤å€¼
        }

        function selectRule(element, rule) {
            // Update UI
            document.querySelectorAll('.rule-item').forEach(item => item.classList.remove('selected'));
            element.classList.add('selected');

            selectedRule = rule;
            selectedSteps = [...ruleSteps[rule]];

            // Update step hint
            document.getElementById('stepHint').textContent = `(å½“å‰è§„åˆ™: ${ruleNames[rule]})`;

            // Update step selection
            const stepItems = document.querySelectorAll('.step-item');
            stepItems.forEach(item => {
                const step = parseInt(item.dataset.step);
                if (selectedSteps.includes(step)) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });

            // Enable/disable step selection based on rule
            if (rule !== 'custom') {
                stepItems.forEach(item => item.style.pointerEvents = 'none');
            } else {
                stepItems.forEach(item => item.style.pointerEvents = 'auto');
            }

            updateSelectedCount();
        }

        function selectAllSteps() {
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.add('selected');
            });
            selectedSteps = [1, 2, 3, 4, 5, 6, 7];
            updateSelectedCount();
        }

        function deselectAllSteps() {
            document.querySelectorAll('.step-item').forEach(item => {
                item.classList.remove('selected');
            });
            selectedSteps = [];
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const count = document.querySelectorAll('.step-item.selected').length;
            document.getElementById('selectedCount').textContent = count;
            selectedSteps = Array.from(document.querySelectorAll('.step-item.selected'))
                .map(item => parseInt(item.dataset.step));
        }

        // Step item click handler
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.step-item').forEach(item => {
                item.addEventListener('click', function() {
                    if (selectedRule === 'custom') {
                        this.classList.toggle('selected');
                        updateSelectedCount();
                    }
                });
            });
        });

        function executeTask() {
            if (selectedSteps.length === 0) {
                showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ­¥éª¤', 'error');
                return;
            }

            // ç”Ÿæˆæç¤ºè¯å†…å®¹
            const targetDir = getTargetDir();
            const promptContent = generatePrompt(targetDir, selectedSteps);

            // æ˜¾ç¤ºæ‰§è¡Œå¯¹è¯æ¡†
            showExecutionDialog(promptContent, targetDir);
        }

        // ç”Ÿæˆ Claude Code æç¤ºè¯
        function generatePrompt(targetDir, steps) {
            const stepDescriptions = {
                1: 'æ‰«æç›®å½•ä¸‹æ‰€æœ‰ .md æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶åˆ—è¡¨',
                2: 'è¯»å–æ¯ä¸ªæ–‡ä»¶çš„å®Œæ•´å†…å®¹',
                3: 'ä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆ 200 å­—å·¦å³çš„æ‘˜è¦ï¼ŒåŒ…å«ä¸»è¦åŠŸèƒ½ã€ç”¨é€”å’Œå…³é”®ä¿¡æ¯',
                4: 'ä¸ºæ¯ä¸ªæ–‡ä»¶æ·»åŠ æ ‡ç­¾ï¼šæ—¶é—´æˆ³ã€æ–‡ä»¶ç±»å‹ã€é‡è¦æ€§è¯„çº§ï¼ˆ1-5æ˜Ÿï¼‰ã€ä¸»é¢˜æ ‡ç­¾',
                5: 'åˆ†ææ–‡ä»¶ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œè¯†åˆ«é‡å¤å†…å®¹å’Œå¯ä»¥åˆå¹¶çš„æ–‡ä»¶',
                6: 'ç”Ÿæˆæˆ–æ›´æ–° README.md ç´¢å¼•æ–‡ä»¶ï¼ŒåŒ…å«æ–‡ä»¶åˆ—è¡¨ã€æ‘˜è¦ã€æ ‡ç­¾ç­‰ä¿¡æ¯',
                7: 'æ ¹æ®åˆ†æç»“æœä¼˜åŒ–æ–‡ä»¶ç»“æ„ï¼šé‡å‘½åã€åˆå¹¶é‡å¤å†…å®¹ã€å½’æ¡£è¿‡æ—¶æ–‡ä»¶'
            };

            const selectedStepDescs = steps.map(s => `${s}. ${stepDescriptions[s]}`).join('\n');

            // å°†è·¯å¾„è½¬æ¢ä¸ºæ­£æ–œæ æ ¼å¼ï¼ˆClaude Code ä½¿ç”¨ Unix é£æ ¼è·¯å¾„ï¼‰
            const unixPath = targetDir.replace(/\\/g, '/');

            const prompt = `è¯·å…ˆåˆ‡æ¢åˆ°ç›®æ ‡å·¥ä½œç›®å½•ï¼š

\`\`\`bash
cd "${unixPath}" && pwd
\`\`\`

ç¡®è®¤ç›®å½•æ­£ç¡®åï¼Œè¯·å¯¹å½“å‰ç›®å½•æ‰§è¡Œæ–‡æ¡£æ•´ç†ä»»åŠ¡ï¼š

**ç›®æ ‡ç›®å½•**: ${targetDir}

**æ‰§è¡Œæ­¥éª¤**:
${selectedStepDescs}

**è¾“å‡ºè¦æ±‚**:
1. æ¯ä¸ªæ­¥éª¤å®Œæˆåæ˜¾ç¤ºè¿›åº¦
2. ç”Ÿæˆ FILE_ANALYSIS.md åŒ…å«è¯¦ç»†åˆ†æ
3. æ›´æ–° README.md ä½œä¸ºæ–‡ä»¶ç´¢å¼•
4. å¦‚æœ‰é‡å¤å†…å®¹ï¼Œæä¾›åˆå¹¶å»ºè®®

è¯·å¼€å§‹æ‰§è¡Œã€‚`;

            return prompt;
        }

        // æ˜¾ç¤ºæ‰§è¡Œå¯¹è¯æ¡†
        function showExecutionDialog(promptContent, targetDir) {
            // åˆ›å»ºå¯¹è¯æ¡†
            const dialog = document.createElement('div');
            dialog.className = 'execution-dialog';
            dialog.innerHTML = `
                <div class="execution-dialog-content">
                    <div class="dialog-header">
                        <h3>ğŸš€ å¯åŠ¨ Claude Code ä»»åŠ¡</h3>
                        <button class="dialog-close" onclick="this.closest('.execution-dialog').remove()">Ã—</button>
                    </div>
                    <div class="dialog-body">
                        <div class="dialog-section">
                            <h4>ğŸ“‹ å·²ç”Ÿæˆçš„ä»»åŠ¡æç¤ºè¯</h4>
                            <textarea class="prompt-textarea" id="promptContent" readonly>${promptContent.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                        </div>

                        <!-- ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ Claude Code -->
                        <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                            <div style="text-align: center; color: white; margin-bottom: 10px;">
                                <div style="font-size: 1rem; font-weight: 600;">ç¬¬ 1 æ­¥ï¼šå¯åŠ¨ Claude Code</div>
                            </div>
                            <button style="width: 100%; display: flex; align-items: center; justify-content: center; font-size: 1rem; padding: 10px; background: white; color: #6366f1; font-weight: 600; border: none; border-radius: 8px; cursor: pointer;" onclick="oneClickLaunch()">
                                å¯åŠ¨ Claude Code
                            </button>
                            <div style="margin-top: 8px; font-size: 0.75rem; color: rgba(255,255,255,0.7); text-align: center;">
                                é¦–æ¬¡ä½¿ç”¨ï¼Ÿ<a href="#" onclick="downloadInstaller()" style="color: white; text-decoration: underline;">ä¸‹è½½å®‰è£…ç¨‹åº</a>
                            </div>
                        </div>

                        <!-- ç¬¬äºŒæ­¥ï¼šå¤åˆ¶æç¤ºè¯ -->
                        <div style="background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                            <div style="text-align: center; color: white; margin-bottom: 10px;">
                                <div style="font-size: 1rem; font-weight: 600;">ç¬¬ 2 æ­¥ï¼šå¤åˆ¶æç¤ºè¯</div>
                            </div>
                            <button style="width: 100%; display: flex; align-items: center; justify-content: center; font-size: 1rem; padding: 10px; background: white; color: #059669; font-weight: 600; border: none; border-radius: 8px; cursor: pointer;" onclick="copyPromptOnly()">
                                å¤åˆ¶æç¤ºè¯
                            </button>
                        </div>

                        <div class="dialog-section">
                            <h4>ğŸ“– æ“ä½œè¯´æ˜</h4>
                            <ol class="manual-steps">
                                <li>ç‚¹å‡»ã€Œå¯åŠ¨ Claude Codeã€æ‰“å¼€ç»ˆç«¯</li>
                                <li>ç‚¹å‡»ã€Œå¤åˆ¶æç¤ºè¯ã€å¤åˆ¶ä»»åŠ¡å†…å®¹</li>
                                <li>åœ¨ Claude Code ä¸­æŒ‰ <strong>Ctrl+V</strong> ç²˜è´´</li>
                                <li>æŒ‰ <strong>å›è½¦</strong> å‘é€ï¼Œç­‰å¾…æ‰§è¡Œå®Œæˆ</li>
                            </ol>
                        </div>
                    </div>
                    <div class="dialog-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.execution-dialog').remove()">å…³é—­</button>
                    </div>
                </div>
            `;

            document.body.appendChild(dialog);
        }

        // Base64 ç¼–ç å‡½æ•°
        function base64Encode(str) {
            try {
                return btoa(unescape(encodeURIComponent(str)));
            } catch (e) {
                // å¯¹äºé ASCII å­—ç¬¦ï¼Œä½¿ç”¨æ›¿ä»£æ–¹æ³•
                return btoa(str);
            }
        }

        // ä¸€é”®å¯åŠ¨ (ä½¿ç”¨åè®®å¤„ç†å™¨)
        function oneClickLaunch() {
            const prompt = document.getElementById('promptContent').value;
            const targetDir = getTargetDir();

            // æ„å»ºä»»åŠ¡æ•°æ®: ç›®å½•|||æç¤ºè¯
            const taskData = targetDir + '|||' + prompt;

            // Base64 ç¼–ç 
            const encodedData = btoa(unescape(encodeURIComponent(taskData)));

            // æ„å»ºåè®® URL
            const protocolUrl = 'claude-task://' + encodedData;

            // å°è¯•æ‰“å¼€åè®®é“¾æ¥
            showNotification('æ­£åœ¨å¯åŠ¨ Claude Code...', 'info');

            // åˆ›å»ºéšè—çš„ iframe æ¥è§¦å‘åè®®
            let iframe = document.getElementById('protocolLauncher');
            if (!iframe) {
                iframe = document.createElement('iframe');
                iframe.id = 'protocolLauncher';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
            }

            // è®¾ç½®è¶…æ—¶æ£€æµ‹
            const startTime = Date.now();
            iframe.src = protocolUrl;

            // ç›‘å¬æ˜¯å¦æˆåŠŸå¯åŠ¨
            setTimeout(() => {
                if (document.hasFocus()) {
                    // é¡µé¢ä»ç„¶æœ‰ç„¦ç‚¹ï¼Œå¯èƒ½åè®®æœªæ³¨å†Œ
                    showNotification('âš ï¸ åè®®æœªå®‰è£…ï¼Ÿç‚¹å‡»"ä¸‹è½½å®‰è£…ç¨‹åº"è¿›è¡Œå®‰è£…', 'warning');
                }
            }, 2000);

            // åŒæ—¶å¤åˆ¶åˆ°å‰ªè´´æ¿ä½œä¸ºå¤‡ä»½
            navigator.clipboard.writeText(prompt).then(() => {
                showNotification('âœ… æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ä½œä¸ºå¤‡ä»½', 'success');
            });
        }

        // ä¸‹è½½å®‰è£…ç¨‹åº
        function downloadInstaller() {
            showNotification('æ­£åœ¨å‡†å¤‡å®‰è£…æ–‡ä»¶...', 'info');

            // ç”Ÿæˆå®‰è£…è„šæœ¬
            const installPs1 = generateInstallPs1();
            const installBat = generateInstallBat();
            const launcherVbs = generateLauncherVbs();

            // ä¸‹è½½æ‰€æœ‰æ–‡ä»¶
            downloadFile(installPs1, 'install_launcher.ps1');
            setTimeout(() => downloadFile(installBat, 'install_launcher.bat'), 300);
            setTimeout(() => downloadFile(launcherVbs, 'launcher.vbs'), 600);

            setTimeout(() => {
                showNotification('ğŸ“ å®‰è£…æ–‡ä»¶å·²ä¸‹è½½ï¼', 'success');
                setTimeout(() => {
                    alert('å®‰è£…æ­¥éª¤ï¼ˆæ¨èæ–¹å¼ï¼‰:\n\n1. åŒå‡» install_launcher.bat\n2. åœ¨å¼¹å‡ºçš„ UAC å¯¹è¯æ¡†ä¸­ç‚¹å‡»"æ˜¯"\n3. ç­‰å¾…å®‰è£…å®Œæˆ\n\nå®‰è£…åå³å¯ä½¿ç”¨ä¸€é”®å¯åŠ¨åŠŸèƒ½ï¼\n\næ³¨æ„: è„šæœ¬ä¼šè‡ªåŠ¨è¯·æ±‚ç®¡ç†å‘˜æƒé™ã€‚');
                }, 500);
            }, 1500);
        }

        function generateInstallPs1() {
            return `# Claude Code Task Launcher - å®‰è£…è„šæœ¬
# è‡ªåŠ¨è¯·æ±‚ç®¡ç†å‘˜æƒé™

$Host.UI.RawUI.WindowTitle = "Claude Code Task Launcher - å®‰è£…ç¨‹åº"

# æ£€æŸ¥æ˜¯å¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
$isAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)

if (-not $isAdmin) {
    # é‡æ–°ä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨
    $scriptPath = $MyInvocation.MyCommand.Path
    Start-Process powershell.exe -Verb RunAs -ArgumentList "-NoProfile -ExecutionPolicy Bypass -File \`\\"$scriptPath\`""
    exit
}

Write-Host ""
Write-Host "  ================================================================" -ForegroundColor Green
Write-Host "     Claude Code Task Launcher - ä¸€é”®å¯åŠ¨å®‰è£…ç¨‹åº" -ForegroundColor Green
Write-Host "  ================================================================" -ForegroundColor Green
Write-Host ""

$scriptDir = Split-Path -Parent $MyInvocation.MyCommand.Path
$installDir = "C:\\claude-launcher"

# æ­¥éª¤ 1: åˆ›å»ºå®‰è£…ç›®å½•
Write-Host "[æ­¥éª¤ 1/4] åˆ›å»ºå®‰è£…ç›®å½•..." -ForegroundColor Cyan
if (-not (Test-Path $installDir)) {
    New-Item -Path $installDir -ItemType Directory -Force | Out-Null
    Write-Host "[å®Œæˆ] $installDir å·²åˆ›å»º" -ForegroundColor Green
} else {
    Write-Host "[è·³è¿‡] ç›®å½•å·²å­˜åœ¨" -ForegroundColor Yellow
}

# æ­¥éª¤ 2: å¤åˆ¶å¯åŠ¨è„šæœ¬
Write-Host ""
Write-Host "[æ­¥éª¤ 2/4] å¤åˆ¶å¯åŠ¨è„šæœ¬..." -ForegroundColor Cyan
$launcherVbs = Join-Path $scriptDir "launcher.vbs"
if (Test-Path $launcherVbs) {
    Copy-Item -Path $launcherVbs -Destination "$installDir\\launcher.vbs" -Force
    Write-Host "[å®Œæˆ] launcher.vbs å·²å¤åˆ¶" -ForegroundColor Green
} else {
    Write-Host "[é”™è¯¯] æ‰¾ä¸åˆ° launcher.vbs æ–‡ä»¶" -ForegroundColor Red
    Write-Host "è¯·ç¡®ä¿ launcher.vbs ä¸æ­¤è„šæœ¬åœ¨åŒä¸€ç›®å½•" -ForegroundColor Red
    pause
    exit 1
}

# æ­¥éª¤ 3: æ³¨å†Œåè®®å¤„ç†å™¨
Write-Host ""
Write-Host "[æ­¥éª¤ 3/4] æ³¨å†Œåè®®å¤„ç†å™¨..." -ForegroundColor Cyan
try {
    $regPath = "HKLM:\\SOFTWARE\\Classes\\claude-task"
    if (Test-Path $regPath) {
        Remove-Item -Path $regPath -Recurse -Force
    }
    New-Item -Path $regPath -Force | Out-Null
    Set-ItemProperty -Path $regPath -Name "(Default)" -Value "URL:Claude Code Task Launcher Protocol"
    Set-ItemProperty -Path $regPath -Name "URL Protocol" -Value ""
    New-Item -Path "$regPath\\DefaultIcon" -Force | Out-Null
    Set-ItemProperty -Path "$regPath\\DefaultIcon" -Name "(Default)" -Value "cmd.exe,1"
    New-Item -Path "$regPath\\shell\\open\\command" -Force | Out-Null
    $command = '"C:\\Windows\\System32\\wscript.exe" "C:\\claude-launcher\\launcher.vbs" "%1"'
    Set-ItemProperty -Path "$regPath\\shell\\open\\command" -Name "(Default)" -Value $command
    Write-Host "[å®Œæˆ] claude-task:// åè®®å·²æ³¨å†Œ" -ForegroundColor Green
} catch {
    Write-Host "[é”™è¯¯] æ³¨å†Œè¡¨å†™å…¥å¤±è´¥: $_" -ForegroundColor Red
    pause
    exit 1
}

# æ­¥éª¤ 4: éªŒè¯å®‰è£…
Write-Host ""
Write-Host "[æ­¥éª¤ 4/4] éªŒè¯å®‰è£…..." -ForegroundColor Cyan
if (Test-Path "$installDir\\launcher.vbs") {
    Write-Host "[å®Œæˆ] å®‰è£…éªŒè¯æˆåŠŸ" -ForegroundColor Green
} else {
    Write-Host "[è­¦å‘Š] å®‰è£…éªŒè¯å¤±è´¥" -ForegroundColor Yellow
}

Write-Host ""
Write-Host "  ================================================================" -ForegroundColor Green
Write-Host "   å®‰è£…å®Œæˆï¼" -ForegroundColor Green
Write-Host "  ================================================================" -ForegroundColor Green
Write-Host ""
Write-Host "  ä½¿ç”¨æ–¹æ³•:"
Write-Host "  1. æ‰“å¼€ä»ªè¡¨æ¿ (dashboard.html)"
Write-Host "  2. é…ç½®ä»»åŠ¡å¹¶ç‚¹å‡»ä¸€é”®å¯åŠ¨"
Write-Host "  3. Claude Code å°†è‡ªåŠ¨å¯åŠ¨å¹¶å‡†å¤‡æ‰§è¡Œä»»åŠ¡"
Write-Host ""
pause
`;
        }

        function generateInstallBat() {
            return '@echo off\nREM å¯åŠ¨ PowerShell å®‰è£…è„šæœ¬ï¼ˆè‡ªåŠ¨è¯·æ±‚ç®¡ç†å‘˜æƒé™ï¼‰\nPowerShell -NoProfile -ExecutionPolicy Bypass -File "%~dp0install_launcher.ps1"\npause\n';
        }

        function generateLauncherVbs() {
            const vbsCode = [
                "Option Explicit",
                "Dim args, encodedData, decodedData, taskData",
                "Dim targetDir, taskPrompt, shell, fso",
                "",
                "Set args = WScript.Arguments",
                "If args.Count = 0 Then WScript.Quit 1",
                "",
                "encodedData = args(0)",
                "If Left(encodedData, 15) = \"claude-task://\" Then",
                "    encodedData = Mid(encodedData, 16)",
                "End If",
                "",
                "decodedData = URLDecode(encodedData)",
                "",
                "If InStr(decodedData, \"|||\") > 0 Then",
                "    targetDir = Split(decodedData, \"|||\")(0)",
                "    taskPrompt = Split(decodedData, \"|||\")(1)",
                "Else",
                "    targetDir = \"\"",
                "    taskPrompt = decodedData",
                "End If",
                "",
                "Set shell = CreateObject(\"WScript.Shell\")",
                "Set fso = CreateObject(\"Scripting.FileSystemObject\")",
                "",
                "' Copy to clipboard",
                "shell.Run \"cmd /c echo \" & EscapeForCmd(taskPrompt) & \" | clip\", 0, True",
                "",
                "' Launch Claude Code",
                "Dim launchCmd",
                "If targetDir <> \"\" Then",
                "    launchCmd = \"cmd /k cd /d \"\"\" & targetDir & \"\"\" && echo [Claude Code Task Launcher] && echo Target: \" & targetDir & \" && echo Prompt copied! Press Ctrl+V to paste && echo. && claude\"",
                "Else",
                "    launchCmd = \"cmd /k echo [Claude Code Task Launcher] && echo Prompt copied! Press Ctrl+V to paste && echo. && claude\"",
                "End If",
                "",
                "shell.Run launchCmd, 1, False",
                "MsgBox \"Claude Code launched!\" & vbCrLf & \"Switch to the new window and press Ctrl+V to paste the task.\", vbInformation, \"Claude Task Launcher\"",
                "",
                "Function URLDecode(str)",
                "    Dim i, char, code, result",
                "    result = \"\": i = 1",
                "    Do While i <= Len(str)",
                "        char = Mid(str, i, 1)",
                "        If char = \"%\" Then",
                "            If i + 2 <= Len(str) Then",
                "                code = Mid(str, i + 1, 2)",
                "                result = result & Chr(CInt(\"&H\" & code))",
                "                i = i + 3",
                "            Else",
                "                result = result & char: i = i + 1",
                "            End If",
                "        ElseIf char = \"+\" Then",
                "            result = result & \" \": i = i + 1",
                "        Else",
                "            result = result & char: i = i + 1",
                "        End If",
                "    Loop",
                "    URLDecode = result",
                "End Function",
                "",
                "Function EscapeForCmd(str)",
                "    Dim result",
                "    result = Replace(str, \"^\", \"^^\")",
                "    result = Replace(result, \"&\", \"^&\")",
                "    result = Replace(result, \"|\", \"^|\")",
                "    result = Replace(result, \"<\", \"^<\")",
                "    result = Replace(result, \">\", \"^>\")",
                "    EscapeForCmd = result",
                "End Function"
            ];
            return vbsCode.join("\r\n");
        }

        function generateProtocolReg() {
            return `Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\\claude-task]
@="URL:Claude Code Task Launcher Protocol"
"URL Protocol"=""

[HKEY_CLASSES_ROOT\\claude-task\\DefaultIcon]
@="cmd.exe,1"

[HKEY_CLASSES_ROOT\\claude-task\\shell]

[HKEY_CLASSES_ROOT\\claude-task\\shell\\open]

[HKEY_CLASSES_ROOT\\claude-task\\shell\\open\\command]
@="\\"C:\\\\Windows\\\\System32\\\\wscript.exe\\" \\"C:\\\\claude-launcher\\\\launcher.vbs\\" \\"%1\\""
`;
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ä»…å¤åˆ¶æç¤ºè¯
        function copyPromptOnly() {
            const prompt = document.getElementById('promptContent').value;
            navigator.clipboard.writeText(prompt).then(() => {
                showNotification('âœ… æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            });
        }

        // å¤åˆ¶å¹¶å°è¯•å¯åŠ¨
        function copyAndLaunch() {
            const prompt = document.getElementById('promptContent').value;
            const targetDir = getTargetDir();

            // å¤åˆ¶æç¤ºè¯åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(prompt).then(() => {
                // ç”Ÿæˆå¹¶ä¸‹è½½è„šæœ¬
                const script = generateBatScript(targetDir, prompt);
                downloadBatFile(script, 'run_claude_task.bat');

                showNotification('âœ… æç¤ºè¯å·²å¤åˆ¶ï¼è„šæœ¬å·²ä¸‹è½½', 'success');

                // æ˜¾ç¤ºä¸‹ä¸€æ­¥æç¤º
                setTimeout(() => {
                    showNotification('ğŸ“ è¯·åŒå‡» run_claude_task.bat å¯åŠ¨', 'info');
                }, 1000);
            });
        }

        // ä¸‹è½½å¯åŠ¨è„šæœ¬
        function downloadScript() {
            const prompt = document.getElementById('promptContent').value;
            const targetDir = getTargetDir();

            const script = generateBatScript(targetDir, prompt);
            downloadBatFile(script, 'run_claude_task.bat');

            showNotification('âœ… è„šæœ¬å·²ä¸‹è½½ï¼åŒå‡» run_claude_task.bat å¯åŠ¨', 'success');
        }

        // ç”Ÿæˆ BAT è„šæœ¬å†…å®¹ - è‡ªåŠ¨æ‰“å¼€æ–°ç»ˆç«¯çª—å£
        function generateBatScript(targetDir, prompt) {
            // å°†æç¤ºè¯ä¸­çš„ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰
            const escapedPrompt = prompt
                .replace(/&/g, '^&')
                .replace(/</g, '^<')
                .replace(/>/g, '^>')
                .replace(/\|/g, '^|');

            // ç”Ÿæˆæç¤ºè¯æ–‡ä»¶å†…å®¹
            const promptLines = prompt.split('\n');

            const script = `@echo off
chcp 65001 >nul
title Claude Code ä»»åŠ¡å¯åŠ¨å™¨
color 0A

echo.
echo  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo  â•‘          Claude Code ä»»åŠ¡å¯åŠ¨å™¨ v1.0                       â•‘
echo  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
echo  â•‘  æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯åŠ¨åç›´æ¥ç²˜è´´å³å¯                  â•‘
echo  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

REM ä¿å­˜æç¤ºè¯åˆ°ä¸´æ—¶æ–‡ä»¶
(
echo ${promptLines.join('\necho ')}
) > "%TEMP%\\claude_prompt.txt"

echo [ä¿¡æ¯] ç›®æ ‡ç›®å½•: ${targetDir}
echo [ä¿¡æ¯] æç¤ºè¯å·²ä¿å­˜åˆ°: %TEMP%\\claude_prompt.txt
echo.

REM åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•
cd /d "${targetDir}"
if errorlevel 1 (
    echo [é”™è¯¯] æ— æ³•åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•
    pause
    exit /b 1
)

echo [æˆåŠŸ] å½“å‰ç›®å½•: %cd%
echo.
echo  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo   å¯åŠ¨è¯´æ˜:
echo   1. Claude Code å³å°†å¯åŠ¨
echo   2. æŒ‰ Ctrl+V ç²˜è´´æç¤ºè¯
echo   3. æŒ‰å›è½¦å‘é€ä»»åŠ¡
echo   4. ç­‰å¾… Claude Code å®Œæˆä»»åŠ¡
echo  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æŒ‰ä»»æ„é”®å¯åŠ¨ Claude Code...
pause >nul

echo.
echo [å¯åŠ¨] æ­£åœ¨å¯åŠ¨ Claude Code...
echo.

REM åœ¨æ–°çª—å£ä¸­å¯åŠ¨ Claude Code
start "Claude Code - %cd%" cmd /k "cd /d "${targetDir}" && claude"

echo.
echo [å®Œæˆ] Claude Code å·²åœ¨æ–°çª—å£ä¸­å¯åŠ¨ï¼
echo [æç¤º] è¯·åˆ‡æ¢åˆ°æ–°çª—å£ï¼ŒæŒ‰ Ctrl+V ç²˜è´´æç¤ºè¯
echo.
echo æŒ‰ä»»æ„é”®å…³é—­æ­¤çª—å£...
pause >nul
`;
            return script;
        }

        // ä¸‹è½½ BAT æ–‡ä»¶
        function downloadBatFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function viewResults() {
            showNotification('æ­£åœ¨æ‰“å¼€ç»“æœé¡µé¢...', 'info');
            // In a real app, this would navigate to results or open a modal
            alert(`ä»»åŠ¡æ‰§è¡Œç»“æœ\n\nå·²å®Œæˆæ­¥éª¤: ${selectedSteps.length}\nè§„åˆ™: ${ruleNames[selectedRule]}\n\nè¯¦ç»†ç»“æœè¯·æŸ¥çœ‹ç”Ÿæˆçš„ README.md å’Œ FILE_ANALYSIS.md`);
        }

        function exportLog() {
            const log = {
                timestamp: new Date().toISOString(),
                rule: selectedRule,
                steps: selectedSteps,
                stepsCompleted: selectedSteps.map(s => ({
                    step: s,
                    name: stepDefinitions[s].name,
                    status: 'completed'
                }))
            };

            const blob = new Blob([JSON.stringify(log, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `task-log-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('æ—¥å¿—å·²å¯¼å‡ºï¼', 'success');
        }

        function runAgain() {
            document.getElementById('progressSection').classList.remove('active');
            isExecuting = false;
        }

        function refreshData() {
            showNotification('æ­£åœ¨åˆ·æ–°æ•°æ®...', 'info');
            setTimeout(() => {
                renderFileList();
                renderTaskFlow();
                renderDirectoryTree();
                renderTagCloud();
                initChart();
                showNotification('æ•°æ®å·²åˆ·æ–°ï¼', 'success');
            }, 500);
        }

        function exportData() {
            const report = {
                title: 'Memory æ–‡æ¡£åº“æŠ¥å‘Š',
                date: new Date().toISOString().split('T')[0],
                stats: {
                    totalFiles: files.length,
                    totalLines: files.reduce((sum, f) => sum + f.lines, 0),
                    avgImportance: (files.reduce((sum, f) => sum + f.importance, 0) / files.length).toFixed(1)
                },
                files: files.map(f => ({
                    name: f.name,
                    type: f.typeName,
                    importance: f.importance,
                    lines: f.lines,
                    summary: f.summary
                }))
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `memory-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('æŠ¥å‘Šå·²å¯¼å‡ºï¼', 'success');
        }

        let currentView = 'grid';
        function toggleView() {
            currentView = currentView === 'grid' ? 'list' : 'grid';
            const fileList = document.getElementById('fileList');
            if (currentView === 'list') {
                fileList.style.display = 'block';
            } else {
                fileList.style.display = 'grid';
                fileList.style.gridTemplateColumns = 'repeat(auto-fill, minmax(250px, 1fr))';
                fileList.style.gap = '10px';
            }
            showNotification(`å·²åˆ‡æ¢åˆ°${currentView === 'grid' ? 'ç½‘æ ¼' : 'åˆ—è¡¨'}è§†å›¾`, 'info');
        }

        function scanFiles() {
            showNotification('æ‰«æåŠŸèƒ½éœ€è¦åç«¯æ”¯æŒï¼Œå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼', 'warning');
        }

        function showStats() {
            const stats = `
ğŸ“Š ç»Ÿè®¡åˆ†ææŠ¥å‘Š

ğŸ“„ æ€»æ–‡ä»¶æ•°: ${files.length}
ğŸ“ æ€»è¡Œæ•°: ${files.reduce((sum, f) => sum + f.lines, 0)}
â­ å¹³å‡é‡è¦æ€§: ${(files.reduce((sum, f) => sum + f.importance, 0) / files.length).toFixed(1)}

ğŸ“ æŒ‰ç±»å‹åˆ†å¸ƒ:
  - æ¨¡æ¿æ–‡æ¡£: ${files.filter(f => f.type === 'template').length} ä¸ª
  - ä½¿ç”¨æŒ‡å—: ${files.filter(f => f.type === 'guide').length} ä¸ª
  - ç´¢å¼•æ–‡æ¡£: ${files.filter(f => f.type === 'index').length} ä¸ª
  - æ‰§è¡Œæ—¥å¿—: ${files.filter(f => f.type === 'log').length} ä¸ª

â­ æŒ‰é‡è¦æ€§åˆ†å¸ƒ:
  - 5æ˜Ÿ(å…³é”®): ${files.filter(f => f.importance === 5).length} ä¸ª
  - 4æ˜Ÿ(é‡è¦): ${files.filter(f => f.importance === 4).length} ä¸ª
  - 3æ˜Ÿ(å‚è€ƒ): ${files.filter(f => f.importance === 3).length} ä¸ª
            `;
            alert(stats);
        }

        // Filter Functions
        function filterFiles() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const type = document.getElementById('typeFilter').value;
            const importance = document.getElementById('importanceFilter').value;

            let filtered = files.filter(file => {
                const matchSearch = !search ||
                    file.name.toLowerCase().includes(search) ||
                    file.summary.toLowerCase().includes(search) ||
                    file.topics.some(t => t.toLowerCase().includes(search)) ||
                    file.keywords.some(k => k.toLowerCase().includes(search));

                const matchType = type === 'all' || file.type === type;
                const matchImportance = importance === 'all' || file.importance === parseInt(importance);

                return matchSearch && matchType && matchImportance;
            });

            renderFilteredFiles(filtered);
            updateStats(filtered);
        }

        function sortFiles() {
            const sortBy = document.getElementById('sortFilter').value;

            const sorted = [...files].sort((a, b) => {
                if (sortBy === 'name') return a.name.localeCompare(b.name);
                if (sortBy === 'lines') return b.lines - a.lines;
                return b.importance - a.importance;
            });

            renderFilteredFiles(sorted);
        }

        function renderFilteredFiles(filteredFiles) {
            const container = document.getElementById('fileList');
            container.innerHTML = filteredFiles.map(file => {
                const iconHtml = getFileIcon(file.type);
                return `
                    <div class="file-item" onclick="showFileDetail('${file.name}')">
                        <div class="file-icon ${file.type}">${iconHtml}</div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">${file.typeName} Â· ${file.lines} è¡Œ Â· ${file.size}</div>
                        </div>
                        <div class="file-stars">${'â­'.repeat(file.importance)}</div>
                    </div>
                `;
            }).join('');
        }

        function getFileIcon(type) {
            const icons = {
                'template': 'ğŸ“‹',
                'guide': 'ğŸ“–',
                'log': 'ğŸ“',
                'index': 'ğŸ—‚ï¸'
            };
            return icons[type] || 'ğŸ“„';
        }

        function updateStats(filteredFiles) {
            document.querySelector('.stat-value').textContent = filteredFiles.length;
        }

        // Notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 10px;
                color: white;
                font-weight: 500;
                z-index: 2000;
                animation: slideIn 0.3s ease-out;
                background: ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : type === 'error' ? '#ef4444' : '#6366f1'};
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // Add animation keyframes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initDirSelect();
            renderFileList();
            renderTaskFlow();
            renderDirectoryTree();
            renderTagCloud();
            initChart();
        });
    </script>
</body>
</html>
