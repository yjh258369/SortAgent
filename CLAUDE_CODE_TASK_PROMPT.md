# Claude Code 任务编排与提示词

> 项目：文档整理与知识库优化  
> 生成时间：2026-02-27  
> 预计耗时：15-20 分钟

---

## 📋 任务概览

### 目标
整理 `/root/.openclaw/workspace/memory/` 目录下的所有文档，生成结构化知识库。

### 输入
- 目录：`/root/.openclaw/workspace/memory/`
- 文件类型：Markdown (.md)

### 输出
- 每个文件的摘要（200字）
- 文件标签系统（时间、类型、重要性）
- README 索引文档
- 重复内容识别报告
- 优化后的文件结构

---

## 🔄 任务流程图

```
[开始]
   ↓
[任务1: 扫描文件] → 获取文件列表
   ↓
[任务2: 读取内容] → 提取文本内容
   ↓
[任务3: 生成摘要] → 每个文件200字摘要
   ↓
[任务4: 打标签] → 时间/类型/重要性
   ↓
[任务5: 相似度分析] → 识别重复内容
   ↓
[任务6: 生成README] → 创建索引文档
   ↓
[任务7: 优化结构] → 重命名/删除文件
   ↓
[完成]
```

---

## 📝 分步提示词

### 任务 1：扫描目标目录

**提示词：**
```
请扫描 /root/.openclaw/workspace/memory/ 目录，列出所有 .md 文件。

要求：
1. 使用 find 或 ls 命令
2. 只列出 .md 文件
3. 显示文件完整路径
4. 输出格式：每行一个文件路径

预期输出示例：
/root/.openclaw/workspace/memory/2026-02-12.md
/root/.openclaw/workspace/memory/2026-02-13.md
...
```

**依赖：** 无  
**超时：** 10 秒

---

### 任务 2：读取文件内容

**提示词：**
```
请读取以下文件的内容：

文件列表：
- /root/.openclaw/workspace/memory/2026-02-12.md
- /root/.openclaw/workspace/memory/2026-02-13.md
- /root/.openclaw/workspace/memory/2026-02-24-0909.md
- /root/.openclaw/workspace/memory/openclaw-update-tasks.md

要求：
1. 逐个读取文件
2. 如果文件超过 1000 行，分段读取
3. 记录每个文件的字符数和行数
4. 如果文件为空或只有元数据，标记为"低价值"

输出格式：
文件名: xxx.md
字符数: xxx
行数: xxx
内容预览: 前100字符...
```

**依赖：** 任务 1  
**超时：** 30 秒

---

### 任务 3：生成文件摘要

**提示词：**
```
为以下文件生成 200 字以内的摘要：

文件：[文件名]
内容：
[文件内容]

要求：
1. 提取核心信息和关键事件
2. 突出技术细节和配置参数
3. 使用简洁的专业语言
4. 字数严格控制在 150-200 字
5. 如果文档包含多个主题，按重要性排序

输出格式：
【文件名】xxx.md
【摘要】[200字摘要]
【关键词】关键词1, 关键词2, 关键词3
```

**依赖：** 任务 2  
**超时：** 每个文件 20 秒

---

### 任务 4：打标签系统

**提示词：**
```
为以下文件打标签：

文件：[文件名]
摘要：[上一步生成的摘要]

请从以下维度打标签：

1. **时间标签**
   - 创建日期（从文件名或内容提取）
   - 最后更新日期
   - 时间跨度（单日/多日/持续更新）

2. **类型标签**（选择1-2个）
   - 配置文档
   - 技术日志
   - 会话记录
   - 故障排查
   - 系统安装
   - API文档
   - 其他

3. **重要性标签**（1-5星）
   ⭐ - 低价值，可删除
   ⭐⭐ - 参考价值低
   ⭐⭐⭐ - 一般参考
   ⭐⭐⭐⭐ - 重要文档
   ⭐⭐⭐⭐⭐ - 关键文档，必须保留

4. **主题标签**（选择相关组件）
   - OpenClaw
   - ShellCrash
   - MySQL
   - DingTalk
   - Gateway
   - 其他

输出格式：
```json
{
  "filename": "xxx.md",
  "time": {
    "created": "2026-02-12",
    "updated": "2026-02-13",
    "span": "single-day"
  },
  "type": ["技术日志", "配置文档"],
  "importance": 5,
  "topics": ["OpenClaw", "ShellCrash"],
  "keywords": ["自动更新", "代理配置", "故障排查"]
}
```
```

**依赖：** 任务 3  
**超时：** 每个文件 15 秒

---

### 任务 5：相似度分析与重复识别

**提示词：**
```
分析以下文件的相似度，识别重复内容：

文件列表及其摘要：
1. [文件名1] - [摘要1]
2. [文件名2] - [摘要2]
...

要求：
1. 对比每对文件的摘要
2. 识别重复的主题、配置、事件
3. 计算重复度（百分比）
4. 判断重复类型：
   - 完全重复（>80%）：建议删除或合并
   - 部分重复（50-80%）：建议精简
   - 状态更新（<50%）：保留两份
   - 无重复（<20%）：独立保留

5. 对于重复内容，提供处理建议：
   - 保留哪份文档
   - 如何合并
   - 需要删除的部分

输出格式：
重复组 1：
- 文件A: xxx.md
- 文件B: yyy.md
- 重复度: 80%
- 重复内容: OpenClaw 自动更新配置
- 建议: 保留 openclaw-update-tasks.md，简化 2026-02-12.md 中的相关部分

重复组 2：
...
```

**依赖：** 任务 3, 任务 4  
**超时：** 60 秒

---

### 任务 6：生成 README 索引

**提示词：**
```
创建 memory 目录的 README.md 文档，包含以下内容：

输入数据：
- 文件清单：[文件列表]
- 摘要数据：[每个文件的摘要]
- 标签数据：[每个文件的标签]
- 重复分析：[重复内容报告]

README 结构：

# Memory 文档索引

> 最后更新：[当前日期]

## 📂 文档列表

### 按类型分组
- 配置文档
  - [文件名](./路径) - 重要性 - 简要说明
- 技术日志
  - [文件名](./路径) - 重要性 - 简要说明

### 按重要性分组
- ⭐⭐⭐⭐⭐ 关键文档
  - [文件名](./路径) - 说明
- ⭐⭐⭐⭐ 重要文档
  - [文件名](./路径) - 说明

## 🏷️ 标签索引

### 按组件
- **OpenClaw**: [文件列表]
- **ShellCrash**: [文件列表]
- **MySQL**: [文件列表]

### 按时间
- 2026-02-12: [文件列表]
- 2026-02-13: [文件列表]

## 🔍 快速查找

**我想了解 OpenClaw 自动更新？**
→ 查看 [文件名](./路径)

**我想了解 ShellCrash 配置？**
→ 查看 [文件名](./路径)

## ⚠️ 待办事项
[从文档中提取的未完成任务]

要求：
1. 使用 Markdown 格式
2. 添加适当的 emoji 增强可读性
3. 所有链接使用相对路径
4. 保持简洁，避免冗余
```

**依赖：** 任务 4, 任务 5  
**超时：** 60 秒

---

### 任务 7：优化文件结构

**提示词：**
```
根据分析结果，优化文件结构：

当前文件：
- 2026-02-12.md
- 2026-02-13.md
- 2026-02-24-0909.md
- openclaw-update-tasks.md

优化建议：
1. 重命名规则：YYYY-MM-DD_brief-description.md
2. 删除低价值文件（重要性 < 2星）
3. 合并高度重复的文件

执行操作：

步骤 1：创建备份
```bash
mkdir -p /root/.openclaw/workspace/memory/archive
cp *.md archive/
```

步骤 2：重命名文件
```bash
mv 2026-02-12.md 2026-02-12_openclaw-shellcrash-setup.md
mv 2026-02-13.md 2026-02-13_mysql-dingtalk-setup.md
```

步骤 3：删除冗余文件
```bash
# 如果确认 2026-02-24-0909.md 无价值
rm 2026-02-24-0909.md
```

步骤 4：更新 README 中的链接
- 修改所有文件引用路径

要求：
1. 执行前必须创建备份
2. 每步操作后验证结果
3. 如果出错，立即回滚
4. 生成操作日志
```

**依赖：** 任务 5, 任务 6  
**超时：** 60 秒  
**需要确认：** 是（删除操作需要用户确认）

---

## 🎯 执行策略

### 方式一：顺序执行（推荐）
适合首次运行，确保每步正确：

```
任务1 → 任务2 → 任务3 → 任务4 → 任务5 → 任务6 → 任务7
```

### 方式二：并行执行
适合文件数量多（>10个）的情况：

```
并行组1: 任务1 (扫描)
   ↓
并行组2: 任务2 (读取所有文件)
   ↓
并行组3: 任务3+4 (为每个文件生成摘要和标签)
   ↓
串行: 任务5 → 任务6 → 任务7
```

### 方式三：增量执行
适合定期维护：

```
1. 扫描新增文件
2. 只处理新增或修改的文件
3. 更新 README
```

---

## ⚙️ 配置参数

```json
{
  "target_directory": "/root/.openclaw/workspace/memory/",
  "file_types": [".md"],
  "summary_length": 200,
  "importance_threshold": 2,
  "duplicate_threshold": 0.8,
  "backup_directory": "./archive/",
  "require_confirmation": true,
  "generate_report": true
}
```

---

## 📊 预期输出

### 1. 文件分析报告 (FILE_ANALYSIS.md)
- 每个文件的摘要
- 标签系统
- 重复内容识别

### 2. 索引文档 (README.md)
- 结构化文件列表
- 标签索引
- 快速查找指南

### 3. 优化后的文件结构
- 重命名的文件
- 删除的冗余文件
- 操作日志

### 4. 统计数据
```
总文件数: 4
处理后: 3
删除: 1
重命名: 2
重复内容: 1 组
总耗时: 18 分钟
```

---

## 🚨 错误处理

### 常见问题

**问题 1：文件读取失败**
```
错误：Permission denied
解决：检查文件权限，使用 sudo 或调整权限
```

**问题 2：摘要生成不完整**
```
错误：文件内容过长
解决：分段读取，分批生成摘要后合并
```

**问题 3：重复识别误判**
```
错误：将状态更新误判为重复
解决：降低重复阈值，增加时间维度判断
```

**问题 4：文件重命名冲突**
```
错误：目标文件已存在
解决：添加时间戳后缀，如 2026-02-12_setup_v1.md
```

---

## 📌 使用示例

### 完整执行
```bash
# 将上述提示词保存为 claude_code_tasks.md
# 然后在 Claude Code 中执行：

"请按照 CLAUDE_CODE_TASK_PROMPT.md 中的任务流程，整理 memory 目录"
```

### 单步执行
```bash
# 只执行某个任务

"请执行任务3：为 memory 目录下的所有文件生成摘要"
```

### 增量更新
```bash
# 只处理新增文件

"请扫描 memory 目录，只为新增的文件生成摘要并更新 README"
```

---

## ✅ 验证清单

执行完成后，检查以下内容：

- [ ] 所有文件都已生成摘要
- [ ] 每个文件都有完整的标签
- [ ] README.md 已创建且链接有效
- [ ] 重复内容已识别并处理
- [ ] 文件已重命名（如需要）
- [ ] 低价值文件已删除（如需要）
- [ ] 备份已创建
- [ ] 操作日志已生成

---

## 🔄 后续维护

### 定期任务
- **每周：** 检查新增文件，更新 README
- **每月：** 运行完整分析，清理重复内容
- **每季度：** 审查重要性标签，归档旧文档

### 自动化建议
创建 cron 任务，每周自动运行：

```bash
# 每周日凌晨 3 点执行
0 3 * * 0 cd /root/.openclaw/workspace && claude-code "执行文档整理任务"
```

---

*本文档可根据实际需求调整参数和流程*
